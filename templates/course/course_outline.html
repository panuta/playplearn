{% extends 'base.html' %}
{% load thumbnail common_tags presentation_tags %}

{% block head_title %}{{ course.title }} - {{ settings.WEBSITE_NAME }}{% endblock %}
{% block body_class %}page-course-outline{% endblock %}

{% block scripts %}
<script>
(function() {
    {% if course_pictures %}
        $('#pictures-slider').royalSlider({
            controlsInside: false,
            globalCaption: true,
            imageScaleMode: 'fill',
            keyboardNavEnabled: true
        });
    {% endif %}

    var scheduleArray = [{% course_schedule_start_datetime_as_comma_separated course_schedules %}]

    $( "#enrollment-calendar" ).datepicker({
        showOtherMonths: true,
        beforeShowDay: function (date) {
            var theday = date.getFullYear() + '/' + (date.getMonth() + 1) + '/' + date.getDate();
            return [false, $.inArray(theday, scheduleArray) >=0 ? 'schedule-date' : ''];
        }
    });

    $('.button-show-all-schedules').on('click', function() {
        $('.schedules-list li').removeClass('hide');
        $(this).closest('li').remove();
        return false;
    });

    $('.course-feedbacks .feedbacks').masonry({
        columnWidth: 570,
        gutter: 30,
        itemSelector: '.style-course-feedback'
    });
})();
</script>
{% endblock %}

{% block body %}
<div class="course-header">
    <div class="container">
        <div class="join"><a href="#join-workshop" class="style-orange-button"><i class="icon-signin"></i> ลงชื่อเข้าร่วม</a></div>
        <h1>{{ course.title }}</h1>
        <div class="course-details">
            <span class="details">
                <span class="caption">หัวข้อ</span>
                <span class="value"><a href="#">{{ course.get_school.name }}</a></span>
            </span>
            <span class="details">
                <span class="caption">ระยะเวลา</span>
                <span class="value"><em>{{ course.duration }}</em> ชั่วโมง</span>
            </span>
            <span class="details">
                <span class="caption">จำนวนคนในกลุ่ม</span>
                <span class="value"><em>{{ course.maximum_people }}</em> คน</span>
            </span>
            <span class="details">
                <span class="caption">จำนวนครั้งที่จะจัด</span>
                <span class="value"><em>{{ course.stats_upcoming_classes }}</em> ครั้ง</span>
            </span>
            <span class="details">
                <span class="caption">ค่าใช้จ่าย</span>
                <span class="value"><em>{{ course.price|floatformat:0 }}</em> บาท</span>
            </span>
        </div>
        <div class="teacher">
            <div class="avatar"><a href="{% url 'view_user_profile' course.teacher.uid %}"><img src="{{ course.teacher.small_avatar_url }}" {% thumbnail_img_size 'avatar_small' %} /></a></div>
            <div class="name">โดย <a href="{% url 'view_user_profile' course.teacher.uid %}">{{ course.teacher.name }}</a></div>
        </div>
    </div>
</div>
<div class="container">

    <div class="row">
        <div class="span8">
            <div class="course-pictures">
                <div id="pictures-slider" class="royalSlider rsDefault">
                    {% for picture in course_pictures %}
                        <img src="{{ picture.image|thumbnail_url:'course_picture_full' }}" alt="{{ picture.description }}" />
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="span4">
            <div class="course-activities">
                <div class="head">กิจกรรม</div>
                <ul>
                    {% for activity in course.activities.all %}
                    <li>{{ activity.title }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% if user.is_authenticated and user == course.teacher %}
            <div class="course-tools">
                <div class="head">Tools for teacher</div>
                <div>
                    <a href="{% url 'edit_course' course.uid %}" class="style-button"><i class="icon-pencil"></i> Edit workshop</a>
                    <a href="{% url 'manage_course_overview' course.uid %}" class="style-button"><i class="icon-book"></i> Manage workshop</a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="course-description">
        {{ course.description|safe }}
    </div>

    <div class="course-place">
        <div class="head"><i class="icon-map-marker"></i> สถานที่</div>
        <div class="clearfix">
            <div class="map"><a href="http://maps.google.com/maps?q={{ course.place.latlng }}"><img src="http://maps.googleapis.com/maps/api/staticmap?center={{ course.place.latlng }}&zoom=13&size=270x180&markers=color:red%7Clabel:S%7C{{ course.place.latlng }}&sensor=false" /></a></div>
            <div class="place">
                <div class="name">{{ course.place.name }}</div>
                <div class="address">{{ course.place.address }}</div>
                <div class="direction">
                    <div class="direction_head">Direction</div>
                    {{ course.place.direction|linebreaks }}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="course-schedules">
    <a name="join-workshop"></a>
    <div class="container">
        <div class="clearfix">
            <div class="schedules-calendar">
                <div id="enrollment-calendar"></div>
                <div class="legend"><i class="available"></i> Has available schedule</div>
            </div>
            <div class="schedules-list">
                <ul>
                    {% for schedule in course_schedules %}
                        <li{% if forloop.counter > 3 %} class="hide"{% endif %}>
                            <div class="schedule">
                                <span class="schedule-date"><i class="icon-calendar"></i> <em>วัน{{ schedule.start_datetime|date:'l' }},</em> {{ schedule.start_datetime|date:'j F Y' }}</span>
                                <span class="schedule-time"><i class="icon-time"></i> {{ schedule.start_datetime|date:'H:i' }} น. - {{ schedule|course_schedule_end_datetime|date:'H:i' }} น.</span>
                            </div>
                            <div class="join">
                                <div class="price">
                                    <span class="number">{{ course.price|floatformat:0 }} บาท</span>
                                    <span class="availability">เหลือที่ว่าง {{ schedule.stats_seats_left }} ที่นั่ง</span>
                                </div>
                                <div class="button">
                                    <a href="#modal-enrollment-confirm" class="style-orange-button" data-schedule-id="{{ schedule.id }}" data-price="{{ course.price|floatformat:0 }}" data-seats-left="{{ schedule.stats_seats_left }}" data-schedule-text="วัน{{ schedule.start_datetime|date:'l' }}, {{ schedule.start_datetime|date:'j F Y' }} เวลา {{ schedule.start_datetime|date:'H:i' }} น."><i class="icon-signin"></i> ลงชื่อ</a>
                                </div>
                            </div>
                        </li>
                        {% if forloop.counter == 4 %}
                            <li><a href="#" class="viewall button-show-all-schedules">View all schedules</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="course-feedbacks">
        <h2><i class="icon-comment"></i> การตอบรับ</h2>
        {% if feedbacks %}
            <div class="feedbacks">
                {% for feedback in feedbacks %}
                    {% include 'snippets/course_feedback_box.html' %}
                {% endfor %}
            </div>
        {% else %}
            <div class="style-no-information">No feedback yet</div>
        {% endif %}
    </div>
</div>





{% endblock %}

{% block modals %}
{% include 'snippets/modal_enrollment_confirm.html' %}
{% endblock %}


{% block body1 %}

<!-- Similar Courses -->

<div class="modal fade hide" id="modal-enrollment-login"></div>

<div class="modal hide" id="modal-enrollment-payment">
{% if page_action == 'payment' and enrollment %}
{% include 'snippets/modal_enrollment_payment.html' %}
<script>$(document).ready(function($) {$('#modal-enrollment-payment').modal();});</script>
{% endif %}
</div>

{% endblock %}