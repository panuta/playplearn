{% extends 'base.html' %}
{% load thumbnail common_tags presentation_tags %}

{% block head_title %}{{ course.title }} - {{ settings.WEBSITE_NAME }}{% endblock %}
{% block body_class %}page-course-outline{% endblock %}

{% block scripts %}
<script>
(function() {
    {% if course.outline_media.exists %}
        $('#pictures-slider').royalSlider({
            controlsInside: false,
            globalCaption: true,
            imageScaleMode: 'fill',
            keyboardNavEnabled: true
        });
    {% endif %}

    $('#enrollment-calendar').datepicker({
        format: 'yyyy-mm-dd',
        todayHighlight: true,
        startDate: '0',
        endDate: '+60d',
        language: 'th'
    })



    $('.button-enroll').on('click', function() {
        var schedule_id = $(this).attr('data-schedule-id');

        var jqxhr = $.post('/ajax/course/enroll/', {schedule_id:schedule_id}, function(response) {
            if(response.status == 'success') {
                var modal;
                if(response.data.enrollment_code) {
                    $('#modal-enrollment-payment').html(response.data.modal_html).modal({backdrop: 'static'});
                } else {
                    $('#modal-enrollment-login').html(response.data.modal_html).modal({backdrop: 'static'});
                }
            } else {
                if(response.message) {
                    _alertModal('error', 'Error occurred', response.message);
                } else {
                    _alertModal('error', 'Error occurred', 'Unknown error');
                }
            }
        }, 'json');

        jqxhr.error(function(jqXHR, textStatus, errorThrown) {
            _alertModal('error', 'Error occurred', errorThrown);
        });

        return false;
    });

    $('.course-feedbacks .feedbacks').masonry({
        columnWidth: 570,
        gutter: 30,
        itemSelector: '.style-course-feedback'
    });
})();
</script>
{% endblock %}

{% block body %}
<div class="course-header">
    <div class="container">
        <div class="enroll"><a href="#course-enrollment" class="style-orange-button"><i class="icon-signin"></i> ลงทะเบียน</a></div>
        <h1>{{ course.title }}</h1>
        <div class="teacher">
            <div class="avatar"><a href="{% url 'view_user_profile' course.teacher.uid %}"><img src="{{ course.teacher.small_avatar_url }}" {% thumbnail_img_size 'avatar_small' %} /></a></div>
            <div class="name">โดย <a href="{% url 'view_user_profile' course.teacher.uid %}">{{ course.teacher.name }}</a></div>
        </div>
    </div>
</div>
<div class="container">
    <div class="course-details">
        <span class="details">
            <span class="caption">หัวข้อ</span>
            <span class="value"><a href="#">{{ course.get_school.name }}</a></span>
        </span>
        <span class="details">
            <span class="caption">ระยะเวลา</span>
            <span class="value"><em>{{ course.duration }}</em> ชั่วโมง</span>
        </span>
        <span class="details">
            <span class="caption">จำนวนคนในกลุ่ม</span>
            <span class="value"><em>{{ course.maximum_people }}</em> คน</span>
        </span>
        <span class="details">
            <span class="caption">จำนวนครั้งที่จะจัด</span>
            <span class="value"><em>{{ course.stats_upcoming_classes }}</em> ครั้ง</span>
        </span>
    </div>
    <div class="row">
        <div class="span8">
            <div class="course-pictures">
                <div id="pictures-slider" class="royalSlider rsDefault">
                    {% for media in course.outline_media.all %}
                        {% if media.media_type == 'PICTURE' %}
                            <img src="{{ media.coursepicture.image|thumbnail_url:'course_picture_full' }}" alt="{{ media.description }}" />
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="span4">
            <div class="course-activities">
                <div class="head">กิจกรรม</div>
                <ul>
                    {% for outline in course.outlines.all %}
                    <li>{{ outline.title }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% if user.is_authenticated and user == course.teacher %}
            <div class="course-tools">
                <div class="head">Tools for teacher</div>
                <div>
                    <a href="{% url 'edit_course' course.uid %}" class="style-button"><i class="icon-pencil"></i> Edit workshop</a>
                    <a href="{% url 'manage_course_overview' course.uid %}" class="style-button"><i class="icon-book"></i> Manage workshop</a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="course-description">
        {{ course.description|safe }}
    </div>

    <div class="course-place">
        <div class="head"><i class="icon-map-marker"></i> สถานที่</div>
        <div class="clearfix">
            <div class="map"><a href="#"><img src="{{ STATIC_URL }}images/sample/map1.png" /></a></div>
            <div class="place">
                <div class="name">{{ course.place.name }}</div>
                <div class="address">{{ course.place.address }}</div>
                <div class="phone"><i class="icon-phone-sign"></i> {{ course.place.phone_number }}</div>
                <div class="direction">
                    {{ course.place.direction|linebreaks }}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="course-enrollment">
    <a name="course-enrollment"></a>
    <div class="container">
        <div class="head"><i class="icon-signin"></i> ลงทะเบียน</div>
        <div class="enrollment clearfix">
            <div class="enroll-calendar">
                <div id="enrollment-calendar"></div>
            </div>
            <div class="enroll-list">
                <ul>
                    <li>
                        <div class="enroll">
                            <span class="price">$40 USD</span>
                            <a href="#" class="button-enroll style-orange-button" data-schedule-id="1">Enroll</a>
                        </div>
                        <div class="schedule">
                            <i class="icon-time"></i>
                            <div class="right">
                                <span class="schedule-date"><em>Sunday,</em> 14 February 2013</span>
                                <span class="schedule-time">6:00 PM</span>
                            </div>
                        </div>
                        <div class="availability">
                            <i class="icon-group"></i>
                            <div class="right">
                                <span class="available">10 slots available</span>
                                <span class="maximum">Limit at 20 students</span>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="enroll">
                            <span class="price">$40 USD</span>
                            <a href="#" class="button-enroll style-orange-button" data-schedule-id="1">Enroll</a>
                        </div>
                        <div class="schedule">
                            <i class="icon-time"></i>
                            <div class="right">
                                <span class="schedule-date"><em>Sunday,</em> 14 February 2013</span>
                                <span class="schedule-time">6:00 PM</span>
                            </div>
                        </div>
                        <div class="availability">
                            <i class="icon-group"></i>
                            <div class="right">
                                <span class="available">10 slots available</span>
                                <span class="maximum">Limit at 20 students</span>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="course-feedbacks">
        <h2><i class="icon-comment"></i> การตอบรับ</h2>
        {% if feedbacks %}
            <div class="feedbacks">
                {% for feedback in feedbacks %}
                    {% include 'snippets/course_feedback_box.html' %}
                {% endfor %}
            </div>
        {% else %}
            <div class="style-no-information">No feedback yet</div>
        {% endif %}
    </div>
</div>
{% endblock %}



{% block body1 %}

<!-- Similar Courses -->

<div class="modal fade hide" id="modal-enrollment-login"></div>

<div class="modal hide" id="modal-enrollment-payment">
{% if page_action == 'payment' and enrollment %}
{% include 'snippets/modal_enrollment_payment.html' %}
<script>$(document).ready(function($) {$('#modal-enrollment-payment').modal();});</script>
{% endif %}
</div>

{% endblock %}